<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Dashboard - Namaskah SMS</title>
    <link rel="stylesheet" href="/static/css/enhanced-dashboard.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1>Namaskah SMS</h1>
                <div class="user-info">
                    <span id="user-credits">N0.00</span>
                    <button id="logout-btn" class="btn-secondary">Logout</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Smart Verification Section -->
            <section id="smart-verification-form" class="verification-section">
                <div class="section-header">
                    <h2>Smart Verification</h2>
                    <span class="beta-badge">Enhanced</span>
                </div>

                <div class="verification-form">
                    <!-- Service Selection -->
                    <div class="form-group">
                        <label for="service-select">Select Service</label>
                        <select id="service-select" class="service-dropdown">
                            <option value="">Loading services...</option>
                        </select>
                        <div id="tier-badge" class="tier-badge" style="display: none;"></div>
                    </div>

                    <!-- Optimization Options -->
                    <div class="optimization-options">
                        <div class="option-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="auto-optimize" checked>
                                <span class="checkmark"></span>
                                Auto-optimize for best success rate
                            </label>
                        </div>
                        
                        <div class="option-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="priority-processing">
                                <span class="checkmark"></span>
                                Priority processing (+$0.50)
                            </label>
                        </div>
                    </div>

                    <!-- Advanced Preferences -->
                    <div class="advanced-preferences">
                        <h4>Advanced Preferences</h4>
                        
                        <div class="preference-row">
                            <div class="form-group">
                                <label for="carrier-select">Preferred Carrier</label>
                                <select id="carrier-select">
                                    <option value="">Any Carrier</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="area-code">Area Code</label>
                                <input type="text" id="area-code" placeholder="e.g., 212" maxlength="3">
                            </div>
                        </div>
                    </div>

                    <!-- Pricing Display -->
                    <div class="pricing-display">
                        <div class="price-main">
                            <span class="price-label">Current Price:</span>
                            <strong id="current-price" class="price-value">N0.00</strong>
                        </div>
                        
                        <div class="price-details">
                            <div id="base-price-container" style="display: none;">
                                <span class="price-label">Base Price:</span>
                                <span id="base-price" class="price-crossed">N0.00</span>
                            </div>
                            
                            <div id="savings" class="savings hidden">
                                <span class="savings-text">Save N0.00</span>
                            </div>
                        </div>

                        <div id="timing-tip" class="timing-tip" style="display: none;"></div>
                    </div>

                    <!-- Optimization Tips -->
                    <div id="optimization-tips" class="optimization-tips" style="display: none;"></div>

                    <!-- Action Button -->
                    <button id="create-verification-btn" class="btn-primary verification-btn">
                        Create Verification
                    </button>
                </div>
            </section>

            <!-- Active Verifications -->
            <section class="verifications-section">
                <div class="section-header">
                    <h3>Active Verifications</h3>
                    <button id="refresh-verifications" class="btn-secondary">Refresh</button>
                </div>
                
                <div id="active-verifications" class="verifications-list">
                    <div class="loading-state">Loading verifications...</div>
                </div>
            </section>

            <!-- Quick Stats -->
            <section class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-verifications">0</div>
                        <div class="stat-label">Total Verifications</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="success-rate">0%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="total-spent">N0.00</div>
                        <div class="stat-label">Total Spent</div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <nav class="sidebar-nav">
                <a href="/app" class="nav-item active">
                    <span class="nav-icon">üì±</span>
                    Dashboard
                </a>
                <a href="/analytics" class="nav-item">
                    <span class="nav-icon">üìä</span>
                    Analytics
                </a>
                <a href="#" class="nav-item" onclick="showWalletModal()">
                    <span class="nav-icon">üí∞</span>
                    Fund Wallet
                </a>
                <a href="#" class="nav-item" onclick="showHistoryModal()">
                    <span class="nav-icon">üìã</span>
                    History
                </a>
            </nav>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h4>Quick Actions</h4>
                <button class="quick-btn" onclick="quickVerify('whatsapp')">
                    <span class="service-icon">üì±</span>
                    WhatsApp
                </button>
                <button class="quick-btn" onclick="quickVerify('telegram')">
                    <span class="service-icon">‚úàÔ∏è</span>
                    Telegram
                </button>
                <button class="quick-btn" onclick="quickVerify('discord')">
                    <span class="service-icon">üéÆ</span>
                    Discord
                </button>
            </div>
        </aside>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Modals -->
    <div id="wallet-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Fund Wallet</h3>
                <button class="modal-close" onclick="closeModal('wallet-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="funding-options">
                    <div class="funding-option">
                        <h4>Paystack Payment</h4>
                        <p>Pay with card, bank transfer, or mobile money</p>
                        <div class="amount-input">
                            <label>Amount (USD):</label>
                            <input type="number" id="fund-amount" min="5" step="0.01" placeholder="5.00">
                        </div>
                        <button class="btn-primary" onclick="initializePayment()">
                            Pay with Paystack
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="history-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Verification History</h3>
                <button class="modal-close" onclick="closeModal('history-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="history-list" class="history-list">
                    Loading history...
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/performance-monitor.js"></script>
    <script src="/static/js/error-tracker.js"></script>
    <script src="/static/js/cache-manager.js"></script>
    <script src="/static/js/smart-verification.js"></script>
    <script src="/static/js/enhanced-dashboard.js"></script>
    <script>
        // Quick verification function
        function quickVerify(service) {
            trackPerformance('quick_verify', service);
            const serviceSelect = document.getElementById('service-select');
            if (serviceSelect) {
                serviceSelect.value = service;
                serviceSelect.dispatchEvent(new Event('change'));
            }
        }

        // Modal functions
        function showWalletModal() {
            document.getElementById('wallet-modal').style.display = 'flex';
        }

        function showHistoryModal() {
            document.getElementById('history-modal').style.display = 'flex';
            loadHistory();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Payment initialization
        async function initializePayment() {
            trackPerformance('payment_init', 'paystack_button');
            const amount = document.getElementById('fund-amount').value;
            if (!amount || amount < 5) {
                alert('Minimum amount is $5.00');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/wallet/paystack/initialize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        amount: parseFloat(amount),
                        payment_method: 'paystack'
                    })
                });

                const result = await response.json();
                if (result.success) {
                    window.open(result.authorization_url, '_blank');
                    closeModal('wallet-modal');
                } else {
                    alert('Payment initialization failed');
                }
            } catch (error) {
                console.error('Payment error:', error);
                alert('Payment initialization failed');
            }
        }

        // Performance tracking
        function trackPerformance(action, element) {
            if (window.performanceMonitor) {
                window.performanceMonitor.trackAction(action, element);
            }
        }

        // Load history
        async function loadHistory() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/verifications/history?limit=20', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await response.json();
                const historyList = document.getElementById('history-list');
                
                if (data.verifications.length === 0) {
                    historyList.innerHTML = '<p>No verifications yet</p>';
                    return;
                }

                historyList.innerHTML = data.verifications.map(v => `
                    <div class="history-item">
                        <div class="history-service">${v.service_name}</div>
                        <div class="history-status status-${v.status}">${v.status}</div>
                        <div class="history-cost">N${v.cost}</div>
                        <div class="history-date">${new Date(v.created_at).toLocaleDateString()}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load history:', error);
                document.getElementById('history-list').innerHTML = '<p>Failed to load history</p>';
            }
        }

        // Close modals on outside click
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>